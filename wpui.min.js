
Element.prototype.data=function(propertyName,value){if(this._wpuidata==undefined){this._wpuidata={}}if(value==undefined){return this._wpuidata[propertyName]}else{this._wpuidata[propertyName]=value}}Element.prototype.nextAll=function(filter){var siblings=[];var el=this;while(el=el.nextSibling){if(!filter||filter(el))siblings.push(el)}return siblings}Element.prototype.html=function(content){if(content==undefined){return this.innerHTML}else{this.innerHTML=content}}Element.prototype.attr=function(propertyName,value){if(value==undefined){return this.getAttribute(propertyName)}else{this.setAttribute(propertyName,value)}}Element.prototype.append=function(html){if(typeof html=='string'){this.insertAdjacentHTML('beforeend',html.trim());return this.lastChild}else this.appendChild(html);return html}Element.prototype.empty=function(){this.html("")}NodeList.prototype.forEach=HTMLCollection.prototype.forEach=function(callback){for(var i=0;i<this.length;i++){callback(this.item(i))}};NodeList.prototype.each=HTMLCollection.prototype.each=function(callback){this.forEach(callback)}Element.prototype.datalockObjectChanged=function(property,oldval,newval){var checkOne=window.performance.now();var datalock=this.data("datalock");this.wpuiFill(datalock);return newval}Element.prototype.wpuiFill=function(baseObject,parent){var me=this;var children=this.children;var originalContent=this.data("wpuiOriginalFill");var htmlContent=false;var fillThrough=true;if(!originalContent){originalContent=this.html();this.data("wpuiOriginalFill",originalContent)}if(children.length==0){htmlContent=originalContent}else{children.each(function(child){if(child.attr("wpui-for")){var forKey=child.attr("wpui-for");if(forKey&&baseObject[forKey]&&baseObject[forKey].constructor===Array){child.wpuiFor(baseObject[forKey])}}else if(child.attr("wpui-object")){var forKey=child.attr("wpui-object");if(forKey&&baseObject[forKey]&&typeof baseObject[forKey]=="object"){child.datalock(baseObject[forKey])}}else if(child.attr("wpui-if")){child.wpuiIf(baseObject,child.attr("wpui-if"))}else if(!child.attr("wpui-stop")&&!child.data("datalock")){if(parent!==undefined)child.wpuiFill(baseObject,parent);else
                    child.wpuiFill(baseObject,me)}else{fillThrough=false}});htmlContent=this.html()}if(htmlContent.indexOf("{{")!=-1&&fillThrough){var newValue=this.replaceVariablesInString(htmlContent,baseObject,parent);this.html(newValue)}for(var i=0,atts=this.attributes,n=atts.length;i<n;i++){var atr=this.attr(atts[i].nodeName);if(atr.indexOf("{{")!=-1){var newValue=this.replaceVariablesInString(atr,baseObject,parent);this.attr(atts[i].nodeName,newValue)}}}Element.prototype.lockNestedProperty=function(baseObject,key,parentElement){var value;var getter="value = baseObject."+key;var addPoint=".";try{eval(getter)}catch(exception){}if(value===undefined){getter="value = baseObject"+key;try{eval(getter);addPoint=""}catch(exception){return value}}var pointIndex=key.lastIndexOf(".");var bracketIndex=key.lastIndexOf("[");var locatedObject="";var locatedProperty="";var sparent=this;if(parentElement!==undefined){sparent=parentElement}if(pointIndex>bracketIndex){locatedObject=key.substr(0,pointIndex);locatedProperty=key.substr(pointIndex+1);var watchVars=sparent.data("watched");if(!watchVars){watchVars=[]}if(watchVars.indexOf(key)==-1){watchVars.push(key);sparent.data("watched",watchVars);var datalockEval="baseObject"+addPoint+locatedObject+".watch(\""+locatedProperty+"\", sparent, sparent.datalockObjectChanged);";eval(datalockEval)}}else if(pointIndex<bracketIndex){locatedObject=key.substr(0,bracketIndex);locatedProperty=key.substr(bracketIndex+1);if(locatedProperty.indexOf("'")>0||locatedProperty.indexOf('"')>0){locatedProperty=locatedProperty.replace("'","").replace('"',"");var datalockEval="baseObject"+addPoint+locatedObject+".watch(\""+locatedProperty+"\", sparent, sparent.datalockObjectChanged);";eval(datalockEval)}}return value}Element.prototype.wpuiIf=function(dataObject,key){var value=wpui_checkValidity(key,dataObject);;var isfalseString=(value==='false');var ifContent=this.data("wpuiIfContent");if(!ifContent){ifContent=this.html();this.data("wpuiIfContent",ifContent)}if(!value||isfalseString){this.empty();var siblings=this.nextAll();var foundTrue=false;siblings.each(function(){if(this.attr("wpui-if")){foundTrue=true;return}if(this.attr("wpui-elseif")){var key2=this.attr("wpui-elseif");var value2=wpui_checkValidity(key2,dataObject);var isfalseString=(value2==='false');var ifElseContent=this.data("wpuiIfContent");if(!ifElseContent){ifElseContent=this.html();this.data("wpuiIfContent",ifElseContent)}if(foundTrue){this.empty();return}if(value2&&!isfalseString){foundTrue=true;this.html(ifElseContent);this.wpuiFill(dataObject)}else{this.empty()}}if(typeof this.attr("wpui-else")!=='undefined'){var elseContent=this.data("wpuiIfContent");if(!elseContent){elseContent=this.html();this.data("wpuiIfContent",elseContent)}if(!foundTrue){foundTrue=true;this.html(elseContent);this.wpuiFill(dataObject)}else{this.empty()}}})}else{var siblings=this.nextAll();this.html(ifContent);siblings.each(function(){if(this.attr("wpui-elseif")||typeof this.attr("wpui-else")!=='undefined'){var previousContent=this.data("wpuiIfContent");if(!previousContent){previousContent=this.html();this.data("wpuiIfContent",previousContent)}this.empty()}});this.wpuiFill(dataObject)}}Element.prototype.wpuiFor=function(dataArray){var me=this;var originalContent=me.data("wpuiForContent");if(!originalContent){originalContent=me.html();me.data("wpuiForContent",originalContent)}me.empty();for(var i=0;i<dataArray.length;i++){var element=originalContent;element=me.append(element);console.log(element,element.constructor);if(element.constructor!=Text)element.datalock(dataArray[i]);else element.data=(this.replaceVariablesInString(element.data,dataArray[i],undefined))}}Element.prototype.datalock=function(dataobject){this.data("datalock",dataobject);var originalContent=this.data("wpuiOriginalContent");if(!originalContent){originalContent=this.html();this.data("wpuiOriginalContent",originalContent)}else{this.empty();this.html(originalContent)}for(var propertyName in dataobject){dataobject.watch(propertyName,this,this.datalockObjectChanged)}this.wpuiFill(dataobject);if(this.attr("wpui-for")){var forKey=this.attr("wpui-for");if(forKey&&dataobject&&dataobject.constructor===Array){this.wpuiFor(dataobject)}}else if(this.attr("wpui-if")){this.wpuiIf(dataobject,this.attr("wpui-if"))}else if(!this.attr("wpui-stop")&&!this.data("datalock")){this.wpuiFill(dataobject)}else this.wpuiFill(dataobject)}NodeList.prototype.datalock=function(dataobject){this.forEach(function(me){me.datalock(dataobject)})}function wpui_checkValidity(key,object){var tt=false;key="tt = object."+key+";";eval(key);return tt}Element.prototype.replaceVariablesInString=function(originalString,object,parent){var replacementString=originalString;var splits=replacementString.split("{{");var items=[];for(var j=0;j<splits.length;j++){if(splits[j].indexOf("}}")!=-1){var subSplit=splits[j].substr(0,splits[j].indexOf("}}"));items.push(subSplit)}}for(var j=0;j<items.length;j++){var key=items[j];var value;if(typeof object=="object"){if(object[key]){value=object[key]}else{console.log("as expected");value=this.lockNestedProperty(object,key,parent)}}else if(key==="value"){value=object}replacementString=replacementString.replace("{{"+key+"}}",value)}return replacementString}if(window.jQuery!==undefined){jQuery.fn.datalock=function(dataobject){for(var i=0;i<this.length;i++){this[i].datalock(dataobject)}}}Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,writable:!1,configurable:!0,value:function(t,e,r){this[t]&&this[t].constructor===Array&&(this[t].oldPush||(this[t].oldPush=this[t].push),this[t].push=function(i){var n=this.oldPush(i);return r.call(e,t,this,this),n});var i=this[t],n=i;delete this[t]&&Object.defineProperty(this,t,{get:function(){return n},set:function(h){return i=n,n=h,n=r.call(e,t,i,h)},enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,writable:!1,configurable:!0,value:function(t){var e=this[t];delete this[t],this[t]=e}});var WPUIBase=function(){this.always=function(selector,event,callback){$("body").on(event,selector,callback)}};var WPUI=new WPUIBase();